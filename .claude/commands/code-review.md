---
description: コミット前の変更をセキュリティ・品質の観点でレビュー。CRITICAL/HIGH/MEDIUM/LOWで分類し、問題があればブロック。
---

# /code-review コマンド

コードレビューを実行するコマンド。

## 実行内容

1. 変更されたファイルを取得: `git diff --name-only HEAD`

2. 各ファイルについてチェック:

**セキュリティ問題 (CRITICAL):**
- ハードコードされた認証情報、APIキー、トークン
- SQLインジェクション脆弱性
- XSS脆弱性
- 入力検証の欠如
- 安全でない依存関係
- パストラバーサルリスク
- **PII暗号化漏れ**
- **監査ログ未記録**

**コード品質 (HIGH):**
- 50行を超える関数
- 800行を超えるファイル
- 4レベルを超えるネスト
- エラーハンドリングの欠如
- console.log文
- TODO/FIXMEコメント
- パブリックAPIのJSDoc欠如

**ベストプラクティス (MEDIUM):**
- ミューテーションパターン
- 新しいコードのテスト欠如
- アクセシビリティの問題（aria-label欠如、タップ領域不足）

3. レポート生成:
   - 重要度: CRITICAL, HIGH, MEDIUM, LOW
   - ファイル位置と行番号
   - 問題の説明
   - 修正提案

4. CRITICALまたはHIGHの問題があればコミットをブロック

## 出力フォーマット

```
[CRITICAL] ハードコードされたAPIキー
ファイル: src/api/client.ts:42
問題: ソースコードにAPIキーが露出
修正: 環境変数に移動

const apiKey = "sk-abc123";  // ❌ 悪い例
const apiKey = process.env.API_KEY;  // ✓ 良い例
```

## 承認基準

- ✅ 承認: CRITICALまたはHIGHの問題なし
- ⚠️ 警告: MEDIUMの問題のみ（注意してマージ可）
- ❌ ブロック: CRITICALまたはHIGHの問題あり

## PsyFit固有のチェック

- タップ領域が44x44px以上か
- フォントサイズが16px以上か
- ステータスバッジの色が規定通りか
- パラメータ化クエリを使用しているか
- PII暗号化が適切か

## 重要

**セキュリティ脆弱性のあるコードは絶対に承認しない!**

## 関連コマンド

- `/plan` - 実装計画を立てる
- `/tdd` - TDDで実装
- `/build-fix` - ビルドエラーを修正
