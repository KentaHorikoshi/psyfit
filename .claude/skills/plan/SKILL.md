# /plan - Implementation Planning Skill

機能実装前の計画立案スキル。

## 使用方法

```
/plan <機能名または説明>
```

## 計画立案ワークフロー

### 1. 要件確認

実装する機能の要件を明確化:

- **目的**: この機能は何を解決するか
- **ユーザー**: 誰が使うか（利用者/職員/両方）
- **スコープ**: 何を含み、何を含まないか
- **制約**: 技術的・ビジネス的な制約

### 2. 関連ドキュメント確認

```
.claude/docs/
├── 01-system-overview.md      # システム概要
├── 02-screen-design.md        # 画面設計
├── 03-database-schema.md      # DB設計
├── 04-api-specification.md    # API仕様
├── 05-security-requirements.md # セキュリティ
├── 06-non-functional-requirements.md # 非機能要件
└── 99-confirmation-items.md   # 確認事項
```

### 3. 影響範囲の特定

#### フロントエンド

| 対象 | 確認項目 |
|------|---------|
| 新規画面 | 画面番号、レイアウト |
| 既存画面の変更 | 影響するコンポーネント |
| 共通コンポーネント | 新規作成/変更が必要か |
| ルーティング | 新規パスの追加 |

#### バックエンド

| 対象 | 確認項目 |
|------|---------|
| API | 新規エンドポイント、変更 |
| モデル | テーブル追加/変更 |
| バリデーション | 入力検証ルール |
| 認可 | アクセス権限 |

#### データベース

| 対象 | 確認項目 |
|------|---------|
| マイグレーション | スキーマ変更 |
| インデックス | パフォーマンス考慮 |
| シード | 初期データ |

### 4. 実装計画書の作成

```markdown
# [機能名] 実装計画

## 概要
[機能の説明]

## 関連ドキュメント
- [関連ドキュメントへのリンク]

## 実装タスク

### Phase 1: データベース
- [ ] マイグレーション作成
- [ ] モデル作成/更新

### Phase 2: バックエンド
- [ ] API エンドポイント実装
- [ ] バリデーション
- [ ] 認可ポリシー

### Phase 3: フロントエンド
- [ ] コンポーネント作成
- [ ] ルーティング設定
- [ ] API連携

### Phase 4: テスト
- [ ] ユニットテスト
- [ ] 統合テスト
- [ ] E2Eテスト

## セキュリティ考慮事項
- [セキュリティ関連の確認事項]

## 確認事項
- [不明点や確認が必要な事項]
```

## 計画テンプレート

### 新規画面追加

```markdown
# U-XX: [画面名] 実装計画

## 画面仕様
- 画面番号: U-XX
- 対象ユーザー: 利用者
- アクセス条件: ログイン必須

## UI設計
- レイアウト: [レイアウト説明]
- 主要コンポーネント:
  - [コンポーネント1]
  - [コンポーネント2]

## API連携
| メソッド | エンドポイント | 用途 |
|---------|--------------|------|
| GET | /api/v1/xxx | データ取得 |
| POST | /api/v1/xxx | データ作成 |

## 実装ファイル
- `src_user/components/UXX_[Name].tsx`
- `src_user/hooks/useXxx.ts`

## テスト
- コンポーネントテスト
- API連携テスト
```

### API追加

```markdown
# API: [エンドポイント名] 実装計画

## エンドポイント仕様
- メソッド: POST
- パス: /api/v1/xxx
- 認証: 必須
- 権限: [必要な権限]

## リクエスト
```json
{
  "field1": "value1",
  "field2": 123
}
```

## レスポンス
```json
{
  "status": "success",
  "data": { ... }
}
```

## バリデーション
- field1: 必須、文字列、最大100文字
- field2: 必須、整数、0-100

## 実装ファイル
- `app/controllers/api/v1/xxx_controller.rb`
- `app/models/xxx.rb`
- `spec/requests/api/v1/xxx_spec.rb`
```

## 計画の承認フロー

1. 計画書作成
2. ユーザーに計画を提示
3. 確認事項があれば質問
4. 承認を得てから実装開始

## チェックリスト

計画完了時に確認:

- [ ] 要件が明確
- [ ] 関連ドキュメントを確認済み
- [ ] 影響範囲を特定
- [ ] セキュリティ考慮済み
- [ ] テスト計画あり
- [ ] 不明点を洗い出し済み
- [ ] ユーザー承認済み
