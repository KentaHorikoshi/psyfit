# PsyFit 実装計画書

作成日: 2026-01-23
最終更新: 2026-01-24
バージョン: 2.0

> **注記**: 進捗状況は [README.md](../README.md) を参照してください。本ドキュメントは計画・設計情報のみを記載しています。

---

## 1. 実装フェーズ概要

### Phase 1: MVP（最小機能製品）
- 認証機能（利用者・職員ログイン）
- 運動メニュー表示・記録
- 体調記録
- 測定値入力（職員）
- ダッシュボード（職員）

### Phase 2: 拡張機能
- 履歴グラフ表示
- レポート出力（CSV）
- 運動メニュー割当（職員→患者）
- 職員管理（マネージャー）
- まとめて記録機能
- パスワードリセット

### Phase 3: 最適化・改善
- パフォーマンス最適化
- プッシュ通知
- E2Eテスト

---

## 2. 実装順序（推奨）

```
Week 1-2: Phase 1.1 認証機能完全実装
    ├── 職員ログインAPI
    ├── セッション管理
    ├── フロントエンド接続
    └── 認証テスト

Week 3-4: Phase 1.2-1.3 運動機能
    ├── 運動メニューAPI
    ├── 運動記録API
    ├── 継続日数ロジック
    └── フロントエンド接続

Week 5: Phase 1.4-1.5 記録機能
    ├── 体調記録API
    ├── 測定値入力API
    └── フロントエンド接続

Week 6: Phase 1.6 職員機能
    ├── 患者一覧・詳細API
    ├── ダッシュボードAPI
    └── フロントエンド接続

Week 7-8: Phase 2 拡張機能
    ├── グラフ表示
    ├── レポート出力
    ├── 職員管理
    └── パスワードリセット

Week 9-10: Phase 3 最適化
    ├── パフォーマンス改善
    ├── テストカバレッジ向上
    └── プッシュ通知（必要に応じて）
```

---

## 3. 技術的決定事項

### API設計
- RESTful API（JSON）
- セッションベース認証（Cookie）
- ページネーション: `page` + `per_page` パラメータ

### 認証
- bcryptでパスワードハッシュ
- セッションタイムアウト: 利用者30分、職員15分
- ログイン失敗5回でアカウントロック

### 暗号化
- PII（name, email, birth_date）はAES-256-GCMで暗号化
- Rails 7+ Active Record Encryption使用

### 監査ログ
- 全API呼び出しをaudit_logsに記録
- action, user_id, ip_address, status, timestampを保存

---

## 4. 確認事項

### 確定済み
| 項目 | 決定内容 |
|------|----------|
| 動画ファイル形式 | **MP4** |
| オフライン視聴 | **不要** |
| ダークモード | **不要** |
| レポート出力形式 | **CSV** |
| 未言及機能 | **全て実装** |

### 未決定
| 項目 | 状況 | 担当 |
|------|------|------|
| 動画ストリーミング方式 | プログレッシブダウンロード推奨 | 開発チーム |
| メール送信サービス | 未確定 | インフラ担当 |
| 本番環境サーバー | 未確定 | インフラ担当 |
| ドメイン | 未確定 | クライアント確認 |

---

## 5. リスク・懸念事項

| リスク | 影響度 | 対策 |
|--------|:------:|------|
| 動画配信の帯域 | 高 | HLS採用、複数ビットレート対応 |
| PII暗号化のパフォーマンス | 中 | 検索はblind indexで対応 |
| テストカバレッジ不足 | 高 | TDD厳守、CI/CDで強制 |
| セッション管理の複雑さ | 中 | Railsデフォルト機能活用 |

---

*この計画書は開発の進捗に応じて更新されます。*
